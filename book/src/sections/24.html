<section id='force-computer-to-move-in-last-cell'>
  <div class='grid'>
    <div class='text'>
      <h2>
        –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–π—Ç–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–ª–µ—Ç–∫—É
        <a href='#force-computer-to-move-in-last-cell' class='anchor'>üîó</a>
      </h2>
    </div>
  </div>
  
  <div class='grid'>
    <div class='text'>
      <p>–¢–∞–∫ –∫–∞–∫ –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –∫–æ–º–ø—å—é—Ç–µ—Ä —Ö–æ–¥–∏–ª —Å–ª—É—á–∞–π–Ω–æ, –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –º–æ–≥ –ø–æ–π—Ç–∏ –≤ —É–∂–µ –∑–∞–Ω—è—Ç—É—é –∫–ª–µ—Ç–∫—É.</p>
      <p>–ù–∞–ø–∏—à–µ–º —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–Ω—É–¥–∏—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä –∑–∞–Ω—è—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É.</p>
    </div>

    <div class='code'>
<pre data-start='84'><div class='code-filename'>test/game.js</div><code class='language-js line-numbers'>test('Computer moves in cell that is not taken', () => { 
  // fill all the cells with user's symbol except last
  for (let i = 0; i &lt; 3; i++) {
    for (let j = 0; j &lt; 3; j++) {
      if (i !== 2 || j !== 2) game.acceptUserMove(i, j)
    }
  }

  game.createComputerMove()
  const board = game.getState()

  const userCount = board.reduce((result, row) => {
    return row.reduce((count, el) => {
      return el === userMoveSymbol ? ++count : count
    }, result)
  }, 0)

  const computerCount = board.reduce((result, row) => {
    return row.reduce((count, el) => {
      return el === computerMoveSymbol ? ++count : count
    }, result)
  }, 0)

  expect(userCount).toBe(8)
  expect(computerCount).toBe(1)
  expect(board[2][2]).toEqual(computerMoveSymbol)
})</code></pre>
    </div>
  </div>

  <div class='grid'>
    <div class='text'>
      <p>–ß—Ç–æ–±—ã –∫–æ–º–ø—å—é—Ç–µ—Ä —Ç–æ—á–Ω–æ –∑–∞–Ω—è–ª —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—É—é –∫–ª–µ—Ç–∫—É, –Ω–∞–º –Ω—É–∂–Ω–æ –æ—Ç—Å–µ–∏–≤–∞—Ç—å –≤—Å–µ –∑–∞–Ω—è—Ç—ã–µ.</p>
      <p>–¢–∞–∫ –∫–∞–∫ —Ö–æ–¥—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Å–ª—É—á–∞–π–Ω—ã, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–∏–∫–ª <i>while</i>, —á—Ç–æ–±—ã —Ä–∞–Ω–æ –∏–ª–∏ –ø–æ–∑–¥–Ω–æ –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—É—é –∫–ª–µ—Ç–∫—É.</p>
      <p>–ß—Ç–æ–±—ã —Ü–∏–∫–ª –Ω–µ —Å—Ç–∞–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º, –ø—Ä–æ–≤–µ—Ä–∏–º, –µ—Å—Ç—å –ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ –≤–æ–æ–±—â–µ.</p>
    </div>

    <div class='code'>
<pre data-start='30'><div class='code-filename'>src/Game.js</div><code class='language-diff line-numbers'>  createComputerMove() {
-   const x = this._getRandomCoordinate()
-   const y = this._getRandomCoordinate()
+   const freeCells = this._board.reduce((total, row) =>
+     row.reduce((count, el) =>
+       el === '' ? ++count : count, total), 0)
+
+   if (!freeCells) return
+
+   let x = this._getRandomCoordinate()
+   let y = this._getRandomCoordinate()
+
+   while (!!this._board[x][y]) {
+     x = this._getRandomCoordinate()
+     y = this._getRandomCoordinate()
+   }</code></pre>
    </div>
  </div>

  <div class='grid'>
    <div class='text'>
      <p>–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏–¥—ë—Ç—Å—è –º–Ω–æ–≥–æ. –í —Ç–µ—Å—Ç–∞—Ö –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø–æ–¥—Å—á—ë—Ç –∫—Ä–µ—Å—Ç–∏–∫–æ–≤ –∏ –Ω–æ–ª–∏–∫–æ–≤ –Ω–∞ –¥–æ—Å–∫–µ. –°—Ç–æ–∏—Ç –≤—ã–Ω–µ—Å—Ç–∏ —ç—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏—é.</p>
      <p>–ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ—Å–∫–∏ –∫—Ä–µ—Å—Ç–∏–∫–∞–º–∏ —Ç–æ–∂–µ –≤—ã–Ω–µ—Å–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ —Ç–µ—Å—Ç–∞ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º.</p>
    </div>

    <div class='code'>
<pre data-start='19'><div class='code-filename'>test/game.js</div><code class='language-js line-numbers'>const fillCells = game => {
  for (let i = 0; i &lt; 3; i++) {
    for (let j = 0; j &lt; 3; j++) {
      if (i !== 2 || j !== 2) game.acceptUserMove(i, j)
    }
  }
}

const count = (arr, symbol) => 
  arr.reduce((result, row) => {
    return row.reduce((count, el) => {
      return el === symbol ? ++count : count
    }, result)
  }, 0)

// ...

  test('Computer moves in cell that is not taken', () => { 
    fillCells(game)

    game.createComputerMove()
    const board = game.getState()

    expect(count(board, userMoveSymbol)).toBe(8)
    expect(count(board, computerMoveSymbol)).toBE(1)
    expect(board[2][2]).toEqual(computerMoveSymbol)
  })</code></pre>
    </div>
  </div>

  <div class='grid'>
    <div class='text'>
      <p>–ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤—ã–Ω–µ—Å–µ–º –≤ –º–µ—Ç–æ–¥—ã <i>_getFreeRandomCoordinates</i> –∏ <i>_getFreeCellsCount</i>. –û–Ω–∏ –º–æ–≥—É—Ç –Ω–∞–º –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –¥–∞–ª—å—à–µ.</p>
    </div>

    <div class='code'>
  <pre data-start='30'><div class='code-filename'>src/Game.js</div><code class='language-js line-numbers'>  createComputerMove() {
    if (this._getFreeCellsCount() === 0) return false
    const [x, y] = this._getFreeRandomCoordinates()
    
    this._updateHistory(this._computerName, x, y)
    this._updateBoard(x, y, {
      symbol: this._computerMoveSymbol
    })
  }

// ...

  _getFreeRandomCoordinates() {
    let x = this._getRandomCoordinate()
    let y = this._getRandomCoordinate()

    while (!!this._board[x][y]) {
      x = this._getRandomCoordinate()
      y = this._getRandomCoordinate()
    }

    return [x, y]
  }

  _getFreeCellsCount() {
    return this._board.reduce((total, row) =>
      row.reduce((count, el) =>
        el === '' ? ++count : count, total), 0)
  }</code></pre>
    </div>
  </div>
</section>